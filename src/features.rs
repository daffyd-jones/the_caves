use crate::enums::{Cells, Door, EnvInter, FeatureType, NPCWrap};
use crate::item::{rand_hermit_item, Item};
use crate::npc::{new_comm_npc, new_conv_npc, new_shop_npc, Convo, ShopConvos, ShopData};
use rand::prelude::SliceRandom;
use rand::Rng;
use std::collections::HashMap;
use std::f64::consts;
use std::fs;

const STREAM: &str = r#"
________________
________________
________________
________________
________________
________________
________________
________________
"#;

const PALETTE: &str = r#"
empty: ' . , ' * |
wall: â–’ |
other â–“ â–‘ ~ |
pipes:
â• â•‘ â•£ â•  â•© â•¦ â•— â• â•š â•” â•¬
â” â”” â”´ â”¬ â”œ â”€ â”¼ â”˜ â”Œ â”¤ â”‚
Ê¬ á»» Î  Ä¦ Ê­ á¹‘ â‘                   
Ð¶ Ñ§ Ï€
á˜‰ á˜ˆ á˜ á˜Š
â‰¡ Â° Ã— Â¤ Â¸ Â¨ Â· â–  Â¦ Â± Â¡ Ã¸ Ã˜ Â©
"#;

const HERMIT_1: &str = r#"
__________
_____â”€â”¬â”€__
_____oâ”‚o__
_____oâ”‚o__
__x__â”€â”´â”€__
__________
"#;

const HERMIT_2: &str = r#"
__________
____â”Œâ”€â”€â”€â”_
____â”‚o_oâ”‚_
____â”‚o_oâ”‚_
__x_â””___â”˜_
__________
"#;

const STREAM_SOURCE_L: &str = r#"
################
___________#####
_~~~~____â•”â•¦â•—____
~~~~~~~~~~~â•£_###
~~~~~~~~~~â•¦â•£_###
~____~~~_____###
___________#####
##########_#####
"#;

const STREAM_SOURCE_R: &str = r#"
################
####____________
####_â•”â•¦â•—__~~~~__
####_â• ~~~~~~~~~~
####_â• â•¦~~~~~~~~~
________~~~__~~~
#######_________
################
"#;

const STREAM_SOURCE_B: &str = r#"
################
####________####
______â•”â•¦â•¦â•—__####
####__â• ~~â•£___###
####__~~~~__####
###__~~~~~__####
####_~~~~~~__###
####__~~~~~_####
"#;

const STREAM_SOURCE_U: &str = r#"
###__~~~~~__####
####_~~~~~~__###
###___~~~~~_####
####__~~~~__####
####__â•£~~â• ___###
###___â•šâ•¦â•¦â•__####
####____________
################
"#;

const STREAM_TRANS: &str = r#"
################
################
################
################
################
################
################
################
"#;

const STREAM_UR: &str = r#"
####__~~~~__####
####__~~~~______
###__~~~~~__~~~_
###__~~~~~~~~~~~
####__~~~~~~~~~~
###_____~~~~____
####____________
################
"#;

const STREAM_UL: &str = r#"
####__~~~~__####
#_#____~~~~__###
______~~~~~__###
~~~_~~~~~~~__###
~~~~~~~~~~__####
__~~~~~______###
____________####
################
"#;

const STREAM_BL: &str = r#"
################
_________#######
__~~~~~____#####
~~~~~~~~~~__####
~~~__~~~~~~__###
______~~~~~__###
##___~~~~~~__###
###___~~~~__####
"#;

const STREAM_BR: &str = r#"
################
#######_________
#####____~~~~___
####___~~~~~~~~~
####__~~~~~~~~~~
###__~~~~~______
###__~~~~____###
####__~~~~__####
"#;

const STREAM_VERT: &str = r#"
####__~~~~__####
###__~~~~~__####
###__~~~~~~__###
###__~~~~~~__###
####__~~~~~__###
###__~~~~~~__###
###__~~~~~__####
####__~~~~__####
"#;

const STREAM_HORZ: &str = r#"
################
#______#_______#
__~~~~___~~~~~__
~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~
_____~~~~~______
###________#####
################
"#;

#[derive(Clone, PartialEq, Eq, Copy, PartialOrd, Ord)]
enum Stream {
    Horz,
    Vert,
    SourceU,
    SourceB,
    SourceL,
    SourceR,
    UR,
    UL,
    BL,
    BR,
    Trans,
    Null,
}

const STREAM_UP_FULL: [Stream; 4] = [Stream::Vert, Stream::BL, Stream::BR, Stream::SourceB];

const STREAM_UP_EMPTY: [Stream; 7] = [
    Stream::Horz,
    Stream::UR,
    Stream::UL,
    Stream::Trans,
    Stream::SourceU,
    Stream::SourceR,
    Stream::SourceL,
];

const STREAM_LEFT_FULL: [Stream; 4] = [Stream::Horz, Stream::UR, Stream::BR, Stream::SourceR];

const STREAM_LEFT_EMPTY: [Stream; 7] = [
    Stream::Vert,
    Stream::UL,
    Stream::BL,
    Stream::Trans,
    Stream::SourceU,
    Stream::SourceB,
    Stream::SourceL,
];

fn build_stream() -> String {
    let mut rng = rand::thread_rng();
    let mut cells = vec![vec![' '; 128]; 64];
    let mut temp = vec![vec![Stream::Trans; 8]; 8];
    // temp[0][0] = Field::OutCornerUL;
    for j in (0..temp.len()) {
        for i in (0..temp[0].len()) {
            let up = if j > 0 { temp[j - 1][i] } else { Stream::Null };
            let left = if i > 0 { temp[j][i - 1] } else { Stream::Null };
            temp[j][i] = {
                match (up, left) {
                    (Stream::Null, Stream::Null) => *[Stream::SourceB, Stream::SourceR]
                        .choose(&mut rng)
                        .unwrap_or(&Stream::SourceB),
                    (up, right) if j == temp.len() - 1 && i == temp[0].len() - 1 => {
                        if STREAM_UP_FULL.contains(&up) {
                            Stream::SourceU
                        } else if STREAM_LEFT_FULL.contains(&right) {
                            Stream::SourceL
                        } else {
                            Stream::Trans
                        }
                    }
                    (Stream::Null, left) => {
                        if i == temp[0].len() - 1 && STREAM_LEFT_FULL.contains(&left) {
                            Stream::BL
                        } else if i == temp[0].len() - 1 && STREAM_LEFT_EMPTY.contains(&left) {
                            Stream::Trans
                        } else if STREAM_LEFT_FULL.contains(&left) {
                            *[Stream::Horz, Stream::BL]
                                .choose(&mut rng)
                                .unwrap_or(&Stream::Horz)
                        } else {
                            Stream::Trans
                        }
                    }
                    (up, Stream::Null) => {
                        if j == temp.len() - 1 && STREAM_UP_FULL.contains(&up) {
                            Stream::UR
                        } else if j == temp.len() - 1 && STREAM_UP_EMPTY.contains(&up) {
                            Stream::Trans
                        } else if STREAM_UP_FULL.contains(&up) {
                            *[Stream::Vert, Stream::UR]
                                .choose(&mut rng)
                                .unwrap_or(&Stream::Vert)
                        } else {
                            Stream::Trans
                        }
                    }
                    (up, left) if i == temp[0].len() - 1 => {
                        if STREAM_UP_FULL.contains(&up) && STREAM_LEFT_FULL.contains(&left) {
                            Stream::UL
                        } else if STREAM_UP_FULL.contains(&up) && STREAM_LEFT_EMPTY.contains(&left)
                        {
                            Stream::Vert
                        } else if STREAM_UP_EMPTY.contains(&up) && STREAM_LEFT_FULL.contains(&left)
                        {
                            Stream::BL
                        } else {
                            Stream::Trans
                        }
                    }
                    (up, left) if j == temp.len() - 1 => {
                        if STREAM_UP_FULL.contains(&up) && STREAM_LEFT_FULL.contains(&left) {
                            Stream::UL
                        } else if STREAM_UP_EMPTY.contains(&up) && STREAM_LEFT_FULL.contains(&left)
                        {
                            Stream::Horz
                        } else if STREAM_UP_FULL.contains(&up) && STREAM_LEFT_EMPTY.contains(&left)
                        {
                            Stream::UR
                        } else {
                            Stream::Trans
                        }
                    }
                    (up, left)
                        if STREAM_UP_FULL.contains(&up) && STREAM_LEFT_FULL.contains(&left) =>
                    {
                        Stream::UL
                    }
                    (up, left)
                        if STREAM_UP_FULL.contains(&up) && STREAM_LEFT_EMPTY.contains(&left) =>
                    {
                        *[Stream::Vert, Stream::UR]
                            .choose(&mut rng)
                            .unwrap_or(&Stream::Vert)
                    }
                    (up, left)
                        if STREAM_UP_EMPTY.contains(&up) && STREAM_LEFT_FULL.contains(&left) =>
                    {
                        *[Stream::Horz, Stream::BL]
                            .choose(&mut rng)
                            .unwrap_or(&Stream::Horz)
                    }
                    (up, left)
                        if STREAM_UP_EMPTY.contains(&up) && STREAM_LEFT_EMPTY.contains(&left) =>
                    {
                        *[Stream::SourceB, Stream::SourceR, Stream::Trans, Stream::BR]
                            .choose(&mut rng)
                            .unwrap_or(&Stream::Trans)
                    }
                    _ => Stream::Trans,
                }
            }
        }
    }
    for j in 0..temp.len() {
        for i in 0..temp[0].len() {
            let patch = match temp[j][i] {
                Stream::Horz => STREAM_HORZ,
                Stream::Vert => STREAM_VERT,
                Stream::SourceU => STREAM_SOURCE_U,
                Stream::SourceB => STREAM_SOURCE_B,
                Stream::SourceL => STREAM_SOURCE_L,
                Stream::SourceR => STREAM_SOURCE_R,
                Stream::UL => STREAM_UL,
                Stream::UR => STREAM_UR,
                Stream::BL => STREAM_BL,
                Stream::BR => STREAM_BR,
                Stream::Trans => STREAM_TRANS,
                _ => todo!(),
            };
            let patch_chars = tile_to_chars(patch);
            for y in 0..8 {
                for x in 0..16 {
                    cells[j * 8 + y][i * 16 + x] = patch_chars[y][x];
                }
            }
        }
    }
    std::iter::once("Null|Null|Null".to_string())
        .chain(cells.iter().map(|row| row.iter().collect::<String>()))
        .collect::<Vec<String>>()
        .join("\n")
}

const GRASS_PATCH: &str = r#"
',',',',',',',',
',",',',',',",',
',',',',',',',',
',',',",',',',',
',',',',',',',',
',",',',',',',',
',',',',',",',',
',',',',',',',',
"#;

const GRASS_PATCH_TRANS: &str = r#"
',',',',',',',',
',",',',',',",',
',',',###,',',',
',','#####',',',
',',#####,',',',
',",'###',',',',
',',',',',",',',
',',',',',',',',
"#;

const GRASS_EMPTY: &str = r#"
________________
________________
_____"__________
________________
_____________'__
__,_____________
___________*____
________________
"#;

const GRASS_EMPTY_TRANS: &str = r#"
####______######
####________####
###__"________##
________________
_____________'__
__,_____________
###________*____
####____________
"#;

const GRASS_IN_CORNER_UL: &str = r#"
',',',',',',',',
',",',',',',",',
',',',',',',',',
',',',",'_','_',
',',','______,__
',",','__,______
',',',",______'_
',',','____*____
"#;

const GRASS_IN_CORNER_BL: &str = r#"
',',',',__._____
',",','_____,___
',',',",________
',',','__"_____.
',',',",_,',_,',
',',',',',',',',
',",',',',',",',
',',',',',',',',
"#;

const GRASS_IN_CORNER_UR: &str = r#"
',',',',',',',',
',',",',',',",',
',',',',',',',',
'_','_',",',',',
_,___.__',',',',
___,____',',",',
_______"_,',',',
__,___,_',',',',
"#;

const GRASS_IN_CORNER_BR: &str = r#"
_,______',',',',
___"____',',",',
______.__,',',',
__'_____',',',',
',',_,',",',',',
',',',',',',',',
',',",',',',",',
',',',',',',',',
"#;

const GRASS_OUT_CORNER_UL: &str = r#"
________________
_,____'______"__
__________,_____
___._____,_,_,__
_,_____,',",','"
_______,',',',',
____"___',",',',
_______,',',',',
"#;

const GRASS_OUT_CORNER_BL: &str = r#"
_______,',",',',
_"_____,',',',',
____.__,',",',',
________',',',',
__'______'__'_'_
______._________
____________,___
___"____._______
"#;

const GRASS_OUT_CORNER_BR: &str = r#"
',',',','_______
',',',",_____"__
',",',','_,_____
',',',',________
_'__'_'_______._
________,_______
_"__________,___
_____.__________
"#;

const GRASS_OUT_CORNER_UR: &str = r#"
________________
__,__________,__
_______"________
_,__,_,____'____
',',',','_______
',',',",______,_
',",',','_._____
',',',',________
"#;

const GRASS_HORZ_U: &str = r#"
__,_____________
_____._____'____
_'____________"_
________"_______
',',',_,',',','_
',",',',',',',',
',',',',',",',',
',',',',',',',',
"#;

const GRASS_HORZ_B: &str = r#"
',",',',',',',',
',',',',',",',',
',',',',',',',',
',',',_,',',','_
_______.________
_"________,_____
______________"_
_____'___.______
"#;

const GRASS_VERT_L: &str = r#"
_______,',',',',
_,_____,',',",',
____"__,',',',',
________',',',',
__'____,',',',',
_____._,',',',',
________',",',',
___'___,',',',',
"#;

const GRASS_VERT_R: &str = r#"
',',',','_______
',',",',__.___'_
',',',','_______
',',',',"___"___
',',',','_____,_
',',',',__,_____
',",',','____'__
',',',','_______
"#;

const SHRUB_PATCH: &str = r#"
',',',',',',',',
',",'&&&',',",',
','&&&&&&&',',',
',&&&&&&&&',',',
','&&&&&&&&,',',
',",'&&&&,',',',
',',',',',",',',
',',',',',',',',
"#;

// Hermit

// const HERMIT_BLANK: &str = r#"Null|Null|Null
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// "#;

// const HERMIT_1: &str = r#"Null|Null|Null
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// ______________________â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”________
// _______________________________â”‚________
// _______________________________â”‚________
// __________________________H____â”˜________
// ________________________________________
// ________________________________________
// ________________________________________
// ________________________________________
// "#;

// Construction

const CONSTRUCTION_BLANK: &str = r#"Null|Null|Null
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
"#;

/*
 ðŸ¬ðŸ¬‘  ðŸ—  ðŸ 

 ðŸ¬® ðŸ¬¡
*/

const PALETTE1: &str = r#"
empty: ' . , ' * |
wall: â–’ |
other â–“ â–‘ ~ |
pipes:
â• â•‘ â•£ â•  â•© â•¦ â•— â• â•š â•” â•¬
â” â”” â”´ â”¬ â”œ â”€ â”¼ â”˜ â”Œ â”¤ â”‚
Ê¬ á»» Î  Ä¦ Ê­ á¹‘ â‘                   
Ð¶ Ñ§ Ï€
á˜‰ á˜ˆ á˜ á˜Š
â‰¡ Â° Ã— Â¤ Â¸ Â¨ Â· â–  Â¦ Â± Â¡ Ã¸ Ã˜ Â©
"#;

const CONSTRUCTION_1: &str = r#"CommNPC CommNPC CommNPC CommNPC CommNPC|Null|Null
######â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“  . ,  C Â·  â–“â–“â–“â–“####
######â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â”¬â”¬â”¬â”¬â”¬â”â”Œâ”¬â”¬â”¬â”¬â”¬â–“â–“â–“â–“â–“â–“##
â–‘â–‘â–‘â–‘â–‘â–‘â–‘ðŸ¬—â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“ðŸ¬ðŸ¬‘        '  â”‚â–“â–“â–“â–“â–“â–“##
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“ðŸ¬®ðŸ¬¡@      *   â”‚â–“â–“â–“â–“â–“â–“##
,   â–‘â–‘â–‘â–‘     Â·, â”‚ @ Â·Â·'   Â·    â”œâ”¬â”¬â”¬â”â–“â–“##
    â–‘â–‘â–‘â–‘     ,  â”‚   ,   Â·   â‘  â”Œâ”€â” â”‚â–“â–“##
.  Â·â–‘â–‘â–‘â–‘ *.     â”œâ”¬â”¬â”    @ Ñ§  â‘ â”œâ•¦â”¤ â”œâ–“â–“##
    â–‘â–‘â–‘â–‘   '   , , â”œâ”¬â”¬â”   ' ,,   @  â–“â–“##
,   â–‘â–‘â–‘â–‘   . ,      * â”œâ”â”Œâ”     @ðŸ¬®ðŸ¬¡ðŸ¬‘â–“â–“ðŸ¬—â–“â–“
    â–‘â–‘â–‘â–‘   .          C  â”œâ”¬â”¬â” Â· â–“â–“â–“â–“ðŸ¬—â–“â–“â–“
    â–‘â–‘â–‘â–‘                '   â”œâ”¬â”¬â”¬â–“â–“â–“â–“â–“ðŸ¬—â–“â–“
    ðŸ¬â–‘â–‘â–‘               , Â·      â–“â–“â–“â–“â–“â–“â–“â–“
"#;

const CONSTRUCTION_2: &str = r#"CommNPC CommNPC CommNPC CommNPC CommNPC CommNPC|Null|Null
' ######### ðŸ¬žâ–“â–“â–“     C   '  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ðŸ­
##        , â–“â–“â–“â–“â”Œâ”¬â”¬â”¬â”¬â”â”Œâ”¬â”¬â”¬â”¬â”â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
## *        â–“â–“â–“â–“         .  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
##.         â–“â–“ðŸ¬‘ðŸ¬—   @  â‘    @ðŸ¬‘â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
##       , 'â–“â–“â–“ðŸ¬¡     Ñ§ â‘    ðŸ¬¡ðŸ¬®â–“â–“   Â·    
##          â–“â–“â–“ðŸ¬—@   â–“â–“â–“ðŸ­   @ðŸ¬¦â–“â–“â–“    '   
##          â–“â–“â–“â–“Ï€@  â–“â–“â–“â–“Â·Â·  â–“â–“â–“â–“   .  , 
## *    '   â–“â–“â–“â–“,   â–“â–“â–“â–“   Â·ðŸ¬¡ðŸ¬—â–“â–“        
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“Â·  @ðŸ¬‘â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ðŸ¬¿
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“   *â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â”Œâ”¬â”¬â”â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
â–“â–“â–“â–“â–“â–“â–“à¶‰â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ðŸ­  C  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
"#;

const CONSTRUCTION_3: &str = r#"CommNPC CommNPC CommNPC CommNPC CommNPC|Null|Null
## '   ,,    '   ,,#########â–“â–“â–“â–“   *â–“â–“â–“â–“
## . ,    * *           â–“â–“â–“â–“â–“ðŸ¬—â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
## .                *  Â·â–“â–“â–“â–“ðŸ¬—â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
##          '        â”Œâ”¬â”â–“â–“â–“â–“â–“ðŸ¬—â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
##              ,CÂ·â”Œâ”¬â”¤  â–“â–“ðŸ¬¡ðŸ¬‘ðŸ¬‘â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“à¶‰
.'     ,   ,  â”Œâ”¬â”â”Œâ”¬â”¤   É… .@ ðŸ¬®â–“â–“â–“    â–“â–“â–“â–“
            â”Œâ”¬â”¤             â–“â–“â–“â–“    â–“â–“â–“â–“
   *      â”Œâ”¬â”¤        Ñ§ â‘ '' ðŸ¬‘â–“â–“â–“  . â–“â–“â–“â–“
     Â· ,  â”‚  *  @  @     @ @ðŸ¬—â–“â–“â–“.   â–“â–“â–“â–“
â–’â–’â–’â–’â–’â–’â–’â–’â–“â–“â–“â–“â–“â–“â–“ðŸ¬‘ðŸ¬¡ðŸ¬‘ðŸ¬—ðŸ¬‘ðŸ¬®â–“â–“â–“ðŸ¬‘ðŸ¬®ðŸ¬¡ðŸ¬®ðŸ¬‘â–“â–“â–“ *  â–“â–“â–“â–“
â–’â–’â–’â–’â–’â–’â–’â–’â–“â–“â–“â–“â–“â–“â–“â–“ðŸ¬‘ðŸ¬®ðŸ¬¡â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“    â–“â–“â–“â–“
â–’â–’â–’â–’â–’â–’â–’â–’â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“    â–“â–“â–“â–“
"#;

const CONSTRUCTION: [&str; 3] = [CONSTRUCTION_1, CONSTRUCTION_2, CONSTRUCTION_3];

// Abandoned shacks

const ABANDONED_SHACK_BLANK: &str = r#"Null|Null|BronzeWarAxe
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
"#;

const ABANDONED_SHACK_1: &str = r#"Null|Null|BronzeWarAxe
###___________________________________##
______________________________________##
____â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’___',___,',',____##
____â–’_Ï€____â”‚________â–’___',",',',',____##
____â–’_____Oâ”‚______.Â¨â‰¡Â°___,',',",',._____
____â–’â”€â”€â”€_â”€â”€â”˜________â–’___',',',',',."____
____â–’_______________â–’___',",',',",'_____
#___â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’__â–’â–’â–’â–’â–’____,',",',','_____
#____________"__",_____,',',',',',,_____
#_____.Ñ§._____________',',",',',",'_____
#_____"*'_____________',",',',',',______
#_______________________________________
"#;

const ABANDONED_SHACK_2: &str = r#"Null|Null|BronzeGreatsword
#####__________________________________#
__,______.,"__,___________________,__._#
_"â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”_____'__â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’,___#
__â”œ",*______â”¤__,_____â–’_________â‰¡â‰¡_â–’_____
__â”œ',"______â”¤_____,"_â–’____________â–’_____
__â”œ'________â”¤________â–’___â”Œâ”€â”€â”¬â”€â”€___â–’___"_
__â”œ_________â”¤___'____â–’___â”‚__2_____â–’_____
__â”œâ”¬â”¬â”¬â”¬â”_â”Œâ”¬â”¬â”¤_"__________â”œâ”€â”€â”˜__â‰¡â‰¡Oâ–’__,__
#_._____________'____â–’___â”‚_____â‰¡â‰¡â‰¡â–’_____
#_______,__.__*______â–’___â”‚____â‰¡â‰¡â‰¡_â–’,____
#___'____._______.___â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’",___
_"__________.______*_______"",'___""____
"#;

const ABANDONED_SHACK_3: &str = r#"Null|Null|BronzeGreatsword
________________#########_______________
_,______É…___É…_______'___,__:â”Œâ”€â”€â”€â”€â”€â”:_,__
_____Ð¶_É…_________,_________:â”‚~~~~~â”‚:____
__"__Ð¶Ð¶__Ñ§___É…________"____:â”‚~~~~~â”‚:__'_
_,__________É…___________.__:â”‚~~~~~â”‚:____
_"â–’â–’â–’â–’â–’â–’â–’â–’â–’,____,",',',____:â””â”€â”€â”€â”€â”€â”˜:_,__
__â–’O__â”‚___â–’"____,',',",',_____Â±_Â±______#
__â–’___â”‚___â–’_____,',',',',',',_,_,_,',__#
_,â–’â”€__â”˜_________,",',',",",',',",",',__#
__â–’â‰¡_____â‰¡â–’__'__,',",',',',",',',',"____
_,â–’â–’â–’â–’â–’â–’â–’â–’â–’,_____',',',',',',',',','__'_
_____'____"_____________________________
"#;

const ABANDONED_SHACK_4: &str = r#"Null|Null|BronzeGreatsword
______________,___________._____########
_Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬___________,________________
_Ê¬Ê¬,Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬____._____"â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’"_
_Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬___________â–’_____â”‚_______â–’__
_Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬"Ê¬Ê¬Ê¬_â”¤_____,___â–’__________Ï€__â–’,_
_Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬_â”¤_________â–’O____â”‚_______â–’__
_Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬_â”¤_________â–’â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€_â”€â”€â–’__
_Ê¬Ê¬Ê¬.Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬_â”¤_______________________â–’,_
_Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬_â”¤__"______â–’_____â”‚_____â‰¡â‰¡â–’__
_Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬_â”¤________,â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’__
_______â”Œâ”¬â”¬â”¬â”¬â”¬â”¤____.____'___________'"___
###______,________________._____________
"#;

const ABANDONED_SHACK_5: &str = r#"Null|Null|BronzeLightAxe BronzeGreatsword
#_____________________________________##
_,.~~~~,__________,____________________#
_"~~~~~~~,__________Ê­Î á»»Î á»»Î Î á»»Î á»»Î Ê­____.___
_~~~~~~~~~,___â•”â•â•â•â•—_Ê­________O_Ê­________
_~~~~~~~~~.___D___â•‘_Ê­__________Ê­________
_~~~~~~~~~~___â•‘__Oâ•‘_Ê­__________Ê­________
_"~~~~~~~~~'__â•šâ•â•â•â•_Ê­__________Ê­________
__,~~~~~~~,_________á»»Î á»»Î Ä¦__Ä¦Î á»»Î á»»________
___.~~~~~,.______________________,______
_______'"______"________________________
_______________________________________#
##_____________________________________#
"#;

const ABANDONED_SHACK_6: &str = r#"Null|Null|BronzeClaymore
##########__________#####____________###
##_______'____________'____________,_###
##_____________,_____â•”â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•—____
#___'â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”'____â•‘_______â”‚____Oâ•‘____
_____â”œá˜‰á˜Šá˜‰á˜Š_&&&&â”¤_____â•‘____â”‚________â•‘___#
_____â”œá˜ˆá˜‰á˜ˆá˜&&&&&â”¤_____â•‘Ï€_â‘_â”‚__â”‚____ðŸ¢â•‘___#
___._â”œ_á˜ˆá˜á˜ˆ_&&&_â”¤_____â•Ÿâ”€â”€â”€â”€â”˜__â”‚_____â•‘"___
_____â”œ__á˜‰______â”¤"____â•‘______â•”â•§â•â•â•â•â•â•____
_____â”œâ”¬â”¬â”¬â”_â”Œâ”¬â”¬â”¬â”¤_____â•‘â‰¡â‰¡â‰¡_______,_____##
#___________________,â•šâ•â•â•â•â•â•â•_________##
#__________________________________#####
#####________#######______________######
"#;

const ABANDONED_SHACK_7: &str = r#"Null|Null|BronzeClaymore
##########__________#####____________###
##_________________________________,_###
##__â•”â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•—_____________________
#___â•‘O__â”‚____Ï€â‘___â•‘'____________________
____â•‘_____________â•‘_______,____________#
____â•‘ðŸ¢__â”‚__â•”â•â•â•â•â•â•â•______'~~~~~~~._____#
___.â•Ÿâ”€â”€â”€â”˜__â•‘______"______~~~~~~~~~______
____â•‘____________________~~~~~~~~~______
____â•‘___â‰¡â‰¡â‰¡â•‘___,_________~~~~~~~~_____##
#___â•šâ•â•â•â•â•â•â•______________~~~~~~______##
#__________________________________#####
#####________#######______________######
"#;

const ABANDONED_SHACK_8: &str = r#"Null|Null|BronzeClaymore
##########__________#####____________###
##_________________________________,_###
##_____.â”Œâ”€â”€â”€â”_______.___________________
#_______â”‚__Oâ”‚,____________â”Œâ”€â”€â”€â”€â”€â”€â”______
_______'â””â”€_â”€â”˜.____________â”‚,'_".'â”‚_____#
____________"___________'â•”â•§â•â•â•â•â•â•â•§â•—____#
___________â•­â”€â”€â”€â”€â”€â”€â”€â”€â•®____â•‘Ï€_____â‰¡â‰¡â•‘_____
____'______â”‚~~~~~~~~â”‚_______â”Œâ”€_â”€â”€â”€â•‘_____
___________â”‚~~~~~~~~â”‚,___â•‘_á¹‘â”‚___ðŸ¢_â•‘___##
#_______"__â•°â”€â”€â”€â”€â”€â”€â”€â”€â•¯____â•šâ•â•â•§â•â•â•â•â•â•___##
#__*___________________________'___#####
#####________#######______________######
"#;

const ABANDONED_SHACK_9: &str = r#"Null|Null|MediumArmour Shroom
##########__________#####____________###
##________________,__________________###
##__â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’'____â”Œâ”¬â”¬â”¬â”¬â”¤_â”œâ”¬â”¬â”¬â”¬â”____
#___â–’O____â”‚______â–’_____â”œá˜ˆá˜‰á˜Šá˜"__,"á˜‰á˜Šâ”¤____
____â–’____ðŸ¢â”‚____â‘_â–’_____â”œá˜‰á˜ˆá˜á˜Š&&._á˜Šá˜ˆá˜â”¤___#
___"â–’â”€â”€_â”€â”€â”¤____Ï€_â–’____.â”œá˜Šá˜‰_&&&&,_Oá˜Šâ”¤___#
____â–’____________â–’_____â”œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¤____
____â–’â–’â–’â–’â–’â–’â–’_â–’â–’â–’â–’â–’â–’"_____________________
______________________à¦Œ_______________##
#______________.______Ñ§_________"_____##
#__*_______________________________#####
#####________#######______________######
"#;

const ABANDONED_SHACK_10: &str = r#"Null|Null|IronLightAxe HealthPotion Apple
##########__________#####____________###
##â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”##
##â”œÊ¬Ê¬Ê¬á˜Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬á˜â”¤__
#_â”œÊ¬á˜ˆÊ¬Ê¬Ê¬á˜Šá˜ˆá˜‰á˜Ê¬á˜Šá˜ˆá˜‰á˜â•”â•â•â•â•â•â•â•â•¤â•â•â•â•—á˜‰á˜Šá˜ˆÊ¬á˜‰á˜Šá˜ˆâ”¤__
__â”œÊ¬&&á˜‰á˜ŠÊ¬Ê¬Ê¬Ê¬á˜ˆ&&Ê¬Ê¬â•‘_______â”‚O_â‰¡â•‘Ê¬Ê¬Ê¬Ê¬á˜‰á˜Š&â”¤__
__â”œÊ¬Ê¬Ê¬Ê¬Ê¬Ê¬á˜‰á˜Šá˜ˆá˜‰Ê¬Ê¬Ê¬Ê¬â•Ÿâ”€â”€â”€â”€â”€_â”€â”¤ðŸ¢__â•‘Ê¬&Ê¬Ê¬Ê¬á˜ˆá˜‰â”¤_#
_'â”œâ•­â”€â”€â”€â•®Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬á˜ˆá˜‰á˜Šâ•‘Ï€â‘_____â””â”€_â”€â•¢Ê¬á˜á˜‰á˜‰á˜Šá˜ˆÊ¬_.#
__â”œâ”‚~~~â”‚Ê¬á˜Šá˜ˆá˜‰á˜‰á˜Šá˜ˆÊ¬Oâ•‘_â•”â•_â•â•—_____â•‘Ê¬Ê¬Ê¬á˜Šá˜ˆá˜‰Ê¬â”__
__â”œâ”‚~~~â”‚Ê¬Ê¬&Ê¬á˜Šá˜ˆá˜‰Ê¬&â•šâ•â•:Â·:â•šâ•â•â•â•â•â•&Ê¬Ê¬á˜Šá˜ˆÊ¬Ê¬â”¤##
#_â”œâ•°â”€â”€â”€â•¯&Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Oá˜‰á˜ŠÊ¬Ê¬Ê¬Ê¬á˜â”¤_#
#_â”œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”&â”Œâ”¬â”¬â”¬â”¤_#
#####________#######_"____________######
"#;

const ABANDONED_SHACK_11: &str = r#"Null|Null|HeavyArmour ShadowAxe
##########__________#####____________###
##â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”##
##â”œÊ¬Ê¬Ê¬á˜Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬á˜â”¤__
#_â”œÊ¬á˜ˆÊ¬Ê¬Ê¬â•”â•â•â•â•¤â•â•â•â•â•â•â•â•—á˜Šá˜ˆá˜‰á˜Ê¬á˜Šá˜ˆá˜‰á˜á˜‰á˜Šá˜ˆÊ¬á˜‰á˜Šá˜ˆâ”¤__
__â”œÊ¬&&á˜‰á˜Šâ•‘__â‰¡â”‚______Oâ•‘Ê¬Ê¬Ê¬Ê¬á˜ˆ&&Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬á˜‰á˜Š&â”¤__
__â”œÊ¬Ê¬Ê¬á˜‰á˜ˆâ•‘ðŸ¢__â”œâ”€_â”€â”€â”€â”€â”€â•¢Ê¬á˜‰á˜Šá˜ˆá˜‰Ê¬Ê¬Ê¬Ê¬&&Ê¬â”Œâ”¬â”¬â”¬â”¤_#
_'â”œ&&Ê¬Ê¬Ê¬â•Ÿâ”€_â”€â”˜_______â•‘Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬á˜ˆá˜‰á˜Šá˜ˆá˜&&____.#
__â”œá˜á˜ˆá˜á˜ˆÊ¬â•‘_______â•”â•_â•â•Ê¬á˜Šá˜ˆá˜‰á˜‰á˜Šá˜ˆÊ¬Ê¬Ê¬Ê¬Ê¬â”Œâ”_â”Œâ”__
__â”œá˜‰á˜Šá˜‰á˜ŠOâ•šâ•â•â•â•â•â•â•â•:Â·:Â·Ê¬&&Ê¬á˜Šá˜ˆá˜‰Ê¬&&Ê¬Ê¬á˜Šá˜ˆÊ¬Ê¬â”¤##
#_â”œá˜‰á˜ˆá˜‰á˜ˆá˜&Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬á˜‰á˜ŠÊ¬Ê¬Ê¬Ê¬á˜â”¤_#
#_â”œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¤_#
#####________#######_"____________######
"#;

const ABANDONED_SHACK_12: &str = r#"Null|Null|SteelHeavyAxe HeavyArmour
##########__________#####____________###
##_________,________'â•”â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•—###
##â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”______â•‘_____Oâ”‚_____â‰¡â‰¡â•‘___
#_â”œá˜‰á˜Šá˜ˆá˜á˜‰á˜Šá˜ˆá˜‰á˜Šá˜ˆá˜â”¤______â•‘ðŸ¢_____â”œâ”€_â”€â”¬â”€â”€â”€â•¢___
__â”œá˜Šá˜ˆá˜á˜‰Ê¬Ê¬".',"â”¤______â•Ÿâ”€â”€_â”€â”€â”€â”˜___D__Oâ•‘__#
__â”œ,&&&Ê¬Ê¬Ê¬â”Œâ”_â”Œâ”¤______â•‘__________â””â”€â”€â”€â•¢._#
__â”œ&&Ê¬Ê¬Ê¬&&â”¤__________â•šâ•â•_â•â•—__Ï€â‘___â‰¡â‰¡â•‘___
__â”œ&&Ê¬.&á˜‰á˜Šâ”¤_â•­â”€â”€â”€â”€â•®___:Â·:Â·:â•šâ•â•â•â•â•â•â•â•â•â•___
__â”œÊ¬Ê¬&á˜‰á˜Šá˜ˆá˜â”¤_â•°â•®~~~â•°â”€â”€â”€â”€â•®_______"_______##
#_â”œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¤_'â•°â•®~~~~~~~â”‚_____à¦Œ_________##
#_____________â•°â”€â”€â”€â”€â”€â”€â”€â•¯_____Ñ§______#####
#####________#######_"____________######
"#;

const ABANDONED_SHACK_13: &str = r#"Null|Null|HeavyArmour
##########__________#####____________###
##â•”â•â•â•â•â•¤â•â•â•¤â•â•â•â•â•â•â•â•—___'____________,_###
##â•‘___Oâ”‚__â”‚_______â•‘â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”________
#_â•‘ðŸ¢___â”‚__________â•‘â”œá˜‰á˜Šá˜ˆá˜á˜‰á˜Šá˜ˆá˜á˜‰á˜Šá˜ˆâ”¤________
_.â•‘____â”‚__â”‚_â•”â•_â•â•â•â•â”œ______"á˜Šá˜ˆá˜á˜‰â”¤'______#
__â•Ÿâ”€â”€_â”€â”˜__â””â”€â•¢:Â·:Â·:Â·â”œâ”_â”Œâ”,___Ê¬Ê¬Ê¬â”¤_______#
__â•‘Ï€â‘_____â‰¡â‰¡â•‘:Â·:Â·:Â·____â”œÊ¬Ê¬Ê¬Ê¬&&á˜ˆâ”¤________
__â•šâ•â•â•â•â•â•â•â•â•â•__________â”œÊ¬Ê¬.&&á˜‰á˜Šâ”¤________
___"___________à¦Œ______.â”œÊ¬Ê¬&á˜‰á˜Šá˜ˆá˜â”¤"_____##
#______________Ñ§_______â”œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¤______##
#_______________________'__________#####
#####________#######______________######
"#;

const ABANDONED_SHACK_14: &str = r#"Null|Null|IronHeavyAxe
##########__________#####____________###
##_________*_________.â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®_,###
##_____à¦Œ______________â•°â•®~~~~~~~~~~â•°â•®____
#______Ñ§___,__________'â•°â•®~~~~~~~~~~â”‚____
__â•”â•â•â•â•â•â•â•¤â•â•â•—:Â·:Â·:Â·_____â•°â”€â”€â”€â”€â”€â•®~~~~â”‚___#
_"â•‘Ï€â‘____â”‚__â•‘:Â·:Â·:Â·___________â•°â”€â”€â”€â”€â•¯"__#
__â•‘_________â•šâ•â•_â•â•â•—â”Œâ”¬â”¬â”_â”Œâ”¬â”¬â”____________
__â•Ÿâ”€â”€_â”€â”€â”€â”________â•‘â”œÊ¬Ê¬Ê¬Ê¬&&á˜ˆâ”¤,___________
__â•‘______â”‚________â•‘â”œÊ¬Ê¬.&&á˜‰á˜Šâ”¤__________##
#_â•‘ðŸ¢_____â”‚O___â‰¡â‰¡â‰¡â‰¡â•‘â”œÊ¬Ê¬&á˜‰á˜Šá˜ˆá˜â”¤__________##
#_â•šâ•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â”œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¤_______#####
#####___'____#######______________######
"#;

const ABANDONED_SHACK_15: &str = r#"Null|Null|HeavyArmour SteelHeavyAxe
##########__________#####____________###
##â•”â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•—___'____________,_###
##â•‘â‰¡â‰¡_____â”‚Â±Â°Ã—Â°Â±_á¹‘â•‘_____â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”___
#_â•‘____â”‚__________â•‘_____â”œá˜‰á˜Šá˜ˆá˜á˜‰á˜Šá˜ˆá˜&&&â”¤___
__â•‘_Ï€_Oâ”‚__â”‚_â•”â•_â•â•â•â•Â·____â”œ&&á˜‰á˜Šá˜ˆá˜á˜‰á˜Šá˜ˆá˜&â”¤__#
__â•Ÿâ”€â”€â”€â”€â”˜__â””â”€â•¢:Â·:Â·:Â·:Â·:__â”œÊ¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬&&&â”¤__#
__â•‘______â‘__â•‘:Â·:Â·:Â·:Â·:__â”œÊ¬Ê¬.Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬â”¤___
__â•Ÿâ”€â”€_â”€â”€â”___â•šâ•â•â•â•â•â•—Â·____â”œÊ¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬,Ê¬Ê¬â”¤___
__â•‘_____â”‚_________â•‘_____â”œÊ¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬Ê¬â”¤_##
#_â•‘ðŸ¢___Oâ”‚â‰¡â‰¡â‰¡â‰¡___á¹‘á¹‘â•‘_____â”œâ”¬â”¬â”¬â”¬â”_â”Œâ”¬â”¬â”¬â”¬â”¤_##
#_â•šâ•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•________________#####
#####________#######______________######
"#;

const ABANDONED_SHACKS: [&str; 15] = [
    ABANDONED_SHACK_1,
    ABANDONED_SHACK_2,
    ABANDONED_SHACK_3,
    ABANDONED_SHACK_4,
    ABANDONED_SHACK_5,
    ABANDONED_SHACK_6,
    ABANDONED_SHACK_7,
    ABANDONED_SHACK_8,
    ABANDONED_SHACK_9,
    ABANDONED_SHACK_10,
    ABANDONED_SHACK_11,
    ABANDONED_SHACK_12,
    ABANDONED_SHACK_13,
    ABANDONED_SHACK_14,
    ABANDONED_SHACK_15,
];

const SMALL_RUIN_1: &str = r#"Null|Null|Null
###___________________##########____________________________##########__________
______________________##########___,________________________##########__________
_,_Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­Ê­______.________________________'_____________________________
___Ê­â‰¡â‰¡___Â±Â©Â©Â±_____Ê­______________________________________,___________________"__
__.Ê­_____________"Ê­_________â•”â•â•â•â•â•â•â•â•â•—__â•”â•â•â•â•â•â•â•â•â•—__â•”â•â•â•â•â•â•â•â•â•—__â•”â•â•â•â•â•â•â•â•â•—______
___Ê­______::______Ê­_________â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘____##
___Ê­______::______Ê­_________â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘____##
___Ê­"_____::______Ê­_________â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘_,__##
___Ê­_____::::_____Ê­,________â•šâ•â•â•â•â•â•â•â•â•__â•šâ•â•â•â•â•â•â•â•â•__â•šâ•â•â•â•â•â•â•â•â•__â•šâ•â•â•â•â•â•â•â•â•____##
_______:::__:::________________________________"______________________________##
_______:::_":::________"___________,_________________________________,________##
_"_____::::::::_____________â•”â•â•â•â•â•â•â•â•â•—__â•”â•â•â•â•â•â•â•â•â•—__â•”â•â•â•â•â•â•â•â•â•—__â•”â•â•â•â•â•â•â•â•â•—____##
____________________________â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘______
___.:____Ä¦::Ä¦____:__________â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘___.__
____:,____::_____:,_______._â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘_.â•‘~~~~~~~~â•‘__â•‘~~~~~~~~â•‘______
____::::::::::::::__________â•šâ•â•â•â•â•â•â•â•â•__â•šâ•â•â•â•â•â•â•â•â•__â•šâ•â•â•â•â•â•â•â•â•__â•šâ•â•â•â•â•â•â•â•â•______
____:_____::"____:________________________""___________________________"________
_________::::_________,____________________________,____________________________
__'_:á»»__Î ____Î __á»»:_____________"___##########________________,_______________###
___________________________________##########________________________________###
"#;

const SMALL_RUIN_2: &str = r#"Null|Null|Null
##______________________________________________________________________########
##___,______á˜‰á˜ˆá˜Š_______â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”_________________________________########
____â•”â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•—___â”œ______Ä¦Â±Ä¦______â”¤___â•”â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•—________________##
____â•‘â‰¡â‰¡___â•‘_Â±Â°Â¤Â°Â±_â•‘___â”œ_â”Œâ”€â”€â”€â”___â”Œâ”€â”€â”€â”_â”¤"__â•‘â‰¡â‰¡â‰¡___â•‘_______â‰¡â‰¡â‰¡â‰¡â•‘________*_______##
____â•‘_____â•‘__:Â·:__â•‘___â”œ_â”‚~~~â”‚___â”‚~~~â”‚_â”¤___â•‘_________________â‰¡â•‘__________________
____â•‘________:Â·:__â•‘___â”œ_â”‚~~~â”‚___â”‚~~~â”‚_â”¤___â•‘______â•‘___________â•‘__________________
____â• â•__â•â•â•__:Â·:__â•‘___â”œ_â””â”€â”€â”€â”˜___â””â”€â”€â”€â”˜_â”¤___â• â•â•â•â•__â•______.____â•‘__________________
____â•‘________:Â·:__â•‘___â”œ_______________â”¤___â•‘á˜‰á˜á˜ˆá˜Š______________â•‘____________,_____
____â•‘_____________â•‘___â”œâ”¬â”¬â”¬â”¬â”¬â”¬Ä¦_Ä¦â”¬â”¬â”¬â”¬â”¬â”¬â”¤___â•‘á˜ˆá˜Š___________________________________
___'â•š_____________â•_______________,'_____"â•‘á˜‰____________________________________
__________:Â·:_______á˜‰á˜á˜ˆá˜Š__________________â•‘á˜_______________________~~~__________
##________:Â·:______á˜ˆá˜á˜ˆá˜Šá˜‰á˜__________________________:Â·:_&&________~~~~~~~~",_____
##________:Â·:_______á˜ˆá˜Šá˜‰á˜á˜ˆ__________________________:Â·:&&&&______~~~~~~~~~~',____
##________:Â·:________á˜ˆá˜Šá˜‰___________________________:Â·:_&&&_______~~~~~~~~~~.____
##________:Â·_Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·_________,__________:Â·:__________~~~~~~~~~~______
__________:Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·________________________________~~~~~~~_______
___,'_____.Â·Â·Â·Â·Â·_.Â·Â·Â·Â·Â·Â·Â·_Â·Â·Â·Â·Â·Â·.___________Â·______________________~~~______###
________________________________________________________'____________________###
#____________________________________________________________________________###
#####________________________________________________________________________###
"#;

const SMALL_RUIN_3: &str = r#"Null|Null|Null
######_______________________________________________________________________###
________________________________________________________________________________
__,____________________________________,,________________â”Œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”__
___'__â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—___â”œ___,_______________â”¤__
______â•‘___â”‚__Â±Â°Â¤Â°Â±__â”‚___â•‘â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡_____________"______â•‘,__â”œ__â”Œâ”€â”€â”€â”€â”:Â·:â”Œâ”€â”€â”€â”€â”._â”¤__
______â•‘___â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜___â•‘â‰¡â‰¡__________________________â•‘___â”œ__â”‚~~~~â”‚:Â·:â”‚~~~~â”‚__â”¤__
______â•‘____:::::::::____â•‘____________________________â•‘___â”œ__â”‚~~~~â”‚:Â·:â”‚~~~~â”‚__â”¤__
____,"â•‘____:Â·:Â·:Â·:Â·:____â•‘____________________________â•‘___â”œ__â””â”€â”€â”€â”€â”˜:Â·:â””â”€~~~â”˜__â”¤__
______â•‘____:Â¨:Â·:Â·:Â¨:____â•‘,___________________________â•‘___â”œ________:Â·:_~~~~~__â”¤__
______â•‘____:Â·:Â¨:Â¨:Â·:____â•©____________.___________________â”œ_.______:Â·:__~~~___â”¤__
______â•‘____:Â¨:Â·:Â·:Â¨:_____________________________________â”œ,________________,"â”¤__
______â•‘_____"____________________________________________â”œâ”¬â”¬â”¬â”¬â”¬â”¬â”¬Ä¦___Ä¦â”¬â”¬â”¬â”¬â”¬â”¬â”¬â”¤__
___.__â•‘_________________________________________________________________________
______â•‘________________________________________________.________________________
______â•šâ•â•*,_________________â•â•â•â•â•â•__________â•â•â•â•â•â•______________________________
________"_____________________________________________________________Ñ§_________
##___________________________________________'__________________________________
##__________________########__,_______________________________________________##
##________________###########_______________########__________________________##
##_______________#############__________################_________________#######
"#;

const SMALL_RUIN_0: &str = r#"
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
"#;

// ponds

const POND_1: &str = r#"Null|Null|Null
##########______________##################_______________________##########
#######__________________#################__________________________#######
##__________________________############_________._____________________####
##__,_________________.___________________________________________'____####
#_______________________________________________________________________###
##_________________________________________"__________â”Œâ”€â”€â”€â”€â”€â”____________##
______',_______________________________________________Ï€____â”‚______________
_______________________________________________________à¦Œ_â‘__â”‚*_____________
______________,'~~~~~~~~~~~~~~~~~~_____________________Ñ§__â‘_â”‚___________###
##_________,~~~~~~~~~~~~~~~~~~~~~~~~~,______________________â”‚___________###
###_____,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_______________â‘___â”‚__________####
###_____~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~____________â””â”€â”€â”€â”€â”€â”˜__________####
##______~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~__________________________####
##______~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_________________________###
________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_________________________
_______"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_____________",________
________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~______________________
________'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~______________________
___________,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~____'_____________________
##______________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~___________________________##
##______.____________,'~~~~~~~~~~~~~~~~~~,______________________________###
##____________________________________________________________,_________###
###_____________________________________________________________________###
#######_______________###############_________________________________#####
########_____________###################_____________________________######
"#;

const POND_2: &str = r#"Null|Null|Null
###____________________________#############_________________________######
###______________________________#########___________________________######
###_,_______________.______",__________________~~~~~~~~~,___________.___###
___________â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”'____________~~~~~~~~~~~~~~~____________###
__________"â”‚__::.:.:.:.:.:.::__â”‚___________.~~~~~~~~~~~~~~~~~'___________##
___________â”‚__à¦Œ____:___:_______â”‚"__________~~~~~~~~~~~~~~~~~~______________
____.______â”‚__Ñ§_:_________:____â”‚,__________~~~~~~~~~~~~~~~~~~~,________,___
__________________________________________~~~~~~~~~~~~~~~~~~~~~____________
#________________________________________,~~~~~~~~~~~~~~~~~~~~~____________
##______________________________________'~~~~~~~~~~~~~~~~~~~~~~'___________
###____'________________________________~~~~~~~~~~~~~~~~~~~~~~~~___________
###_______________________________,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'__________
###________________,_____~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~___"_______
###________________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~____________
##______________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'____________
##_________.___~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_____________
_______________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_____________
________________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~______*____#
____,____________"'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_________##
___________________'_,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"________##
##____________________'___"_,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,_________##
###________________________________',____"~~~~~~~~~~~~~~~~~,__'__________##
###_____'_______________________________________"___________________,____##
#####___________##############__________________________###################
######_________#################_____________________######################
"#;

const POND_3: &str = r#"Null|Null|Null
###___################________________################_______________######
###____#############_____________"___________________________________######
###____________._______________________________________'_____&&&&_______###
##______",_________________________________'________________&&&&&&_________
##__________________________________________________________&&&&&&_________
##_________________,',"~~~~~~~~~~~~_____________.____________&&&.________##
#______________,'.','~~~~~~~~~~~~~~~~~~~_____________________,__________###
#___,_________'.","~~~~~~~~~~~~~~~~~~~~~~~~~~~~_________________________###
#_____________','~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_______________________###
#_____________,',~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_________________"___###
#_____________,"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_________________###
#______________*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~______________###
_______"________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_____________##
_________________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_______________
___________,______~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~_______________
______&&&_________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'__"_____'_________
_____&&&&&&__________~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~,'____________________
_____&&&&&&_______________~~~~~~~~~~~~~~~~~~~~~,"________________________##
_______&&&_______________________________________________________________##
_______________________________._______________________*_________________##
____'________,___________________________________________________________##
##______________________________________,_____________________________.__##
##_______________________________________"_______________________________##
#########___________##########___________________________________##########
###########________##############____________________________##############
"#;

const POND: [&str; 3] = [POND_1, POND_2, POND_3];

const ralette: &str = r#"
empty: ' . , ' * |
wall: â–’ |
other â–“ â–‘ ~ |
pipes:
â• â•‘ â•£ â•  â•© â•¦ â•— â• â•š â•” â•¬
â” â”” â”´ â”¬ â”œ â”€ â”¼ â”˜ â”Œ â”¤ â”‚

Ê¬ á»» Î  Ä¦ Ê­                     
Ð¶ Ñ§ Ï€
 
â‰¡ Â° Ã— Â¤ Â¸ Â¨ Â· â–  Â¦ Â± Â¡ Ã¸ Ã˜ Â©

i Ì¾Â¡  Í”Â¡  ÍŠÂ¡  Í›Â¡  Ì·Â¡  Ì¸Â¡  ÌšÂ¡  Í†Â¡ Â¡Ëž Â¡Ë¡  Ì¢Â¡ Â¡     

"#;

const TEMP: &str = r#"
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
________________________________________________________________________________
"#;

const SMALL_RUINS: [&str; 3] = [SMALL_RUIN_1, SMALL_RUIN_2, SMALL_RUIN_3];

fn ch_to_enum(ch: char) -> Cells {
    match ch {
        '_' => Cells::Empty,
        '#' => Cells::Transparent,
        ',' => Cells::Grass1,
        'âš¶' => Cells::TallGrass,
        '\'' => Cells::Grass2,
        '\"' => Cells::Grass3,
        'Â·' => Cells::Dirt1,
        '.' => Cells::Dirt2,
        ':' => Cells::Dirt3,
        '*' => Cells::Rock,
        'â–’' => Cells::Wall,
        'â–“' => Cells::Wall2,
        'â–ˆ' => Cells::Wall3,
        'â–‘' => Cells::Wall4,
        'à¶‰' => Cells::Roots,
        'ðŸ¬¤' => Cells::Broken1,
        'ðŸ¬—' => Cells::Broken2,
        'ðŸ¬' => Cells::Broken3,
        'ðŸ¬‘' => Cells::Broken4,
        'ðŸ¬®' => Cells::Broken5,
        'ðŸ¬¡' => Cells::Broken6,
        ' ' => Cells::Floor,
        'â–§' => Cells::Tile1,
        'â–¨' => Cells::Tile2,
        'â–©' => Cells::Tile3,
        '~' => Cells::Water,
        'â•' => Cells::MwH,
        'â•‘' => Cells::MwV,
        'â•£' => Cells::MwVL,
        'â• ' => Cells::MwVR,
        'â•©' => Cells::MwHU,
        'â•¦' => Cells::MwHD,
        'â•' => Cells::MwUL,
        'â•š' => Cells::MwUR,
        'â•—' => Cells::MwDL,
        'â•”' => Cells::MwDR,
        'â•¬' => Cells::MwCR,
        'â”€' => Cells::SwH,
        'â”‚' => Cells::SwV,
        'â”¤' => Cells::SwVL,
        'â”œ' => Cells::SwVR,
        'â”´' => Cells::SwHU,
        'â”¬' => Cells::SwHD,
        'â”˜' => Cells::SwUL,
        'â””' => Cells::SwUR,
        'â”' => Cells::SwDL,
        'â”Œ' => Cells::SwDR,
        'â”¼' => Cells::SwCR,
        'â•Ÿ' => Cells::BsVR,
        'â•¢' => Cells::BsVL,
        'â•¤' => Cells::BsHD,
        'â•§' => Cells::BsHU,
        'â•­' => Cells::CurUL,
        'â•®' => Cells::CurUR,
        'â•°' => Cells::CurBL,
        'â•¯' => Cells::CurBR,
        'â”†' => Cells::BknWV,
        'â”„' => Cells::BknWH,
        'â‰¡' => Cells::Cong,
        'Â°' => Cells::Deg,
        'Ã—' => Cells::Mult,
        'Â¸' => Cells::Ced,
        'Â¨' => Cells::Diae,
        'â– ' => Cells::Blsq,
        'Â¦' => Cells::VBrk,
        'Â±' => Cells::PlMin,
        'Ã¸' => Cells::SmZer,
        'Ã˜' => Cells::BZer,
        'Â©' => Cells::Cop,
        'Ä¦' => Cells::DblBracedGate, //-------
        'á»»' => Cells::BracedGate,
        'Î ' => Cells::Arch,
        'Ê­' => Cells::Bricks,
        'Ê¬' => Cells::Crops,
        'Ñ§' => Cells::SmallCampfire,
        'Ñ¦' => Cells::Campfire,
        'Ï€' => Cells::Table,
        'Ð¶' => Cells::Firewood,
        'à¦Œ' => Cells::FireSmoke,
        'É…' => Cells::Tent,
        'ðŸ¢' => Cells::Bed,
        '&' => Cells::Bush,
        'á˜‰' => Cells::Bramble1,
        'á˜ˆ' => Cells::Bramble2,
        'á˜' => Cells::Bramble3,
        'á˜Š' => Cells::Bramble4,
        '{' => Cells::LBrce,
        '}' => Cells::RBrce,
        '(' => Cells::LParen,
        ')' => Cells::RParen,
        'Â¤' => Cells::GenCur,
        'o' => Cells::Item,
        'l' => Cells::Log,
        'c' => Cells::Clinic,
        'p' => Cells::GPost,
        's' => Cells::CPost,
        _ => Cells::Empty,
    }
}

pub fn parse_map(
    s_map: &str,
    mut cells: Vec<Vec<Cells>>,
) -> (
    Vec<Vec<Cells>>,
    HashMap<(usize, usize), NPCWrap>,
    HashMap<(usize, usize), Item>,
    HashMap<(usize, usize), EnvInter>,
) {
    // let mut cells: Vec<Vec<Cells>> = Vec::new();
    let mut rng = rand::thread_rng();
    let map_codet = s_map.lines().next().unwrap_or("");
    let map_code: Vec<&str> = map_codet.split("|").collect();
    let npc_types: Vec<&str> = map_code.clone()[0].split(" ").collect();
    let item_types: Vec<&str> = map_code.clone()[2].split(" ").collect();

    let data1 = fs::read_to_string("src/npcs/npc_names.json");
    //log::info!("{:?}", &data1);
    let names: Vec<String> = match data1 {
        Ok(content) => serde_json::from_str(&content).unwrap(),
        Err(e) => {
            log::info!("{:?}", e);
            Vec::new()
        }
    };

    let data2 = fs::read_to_string("src/npcs/npc_comms.json");
    //log::info!("{:?}", &data2);
    let comms: Vec<String> = match data2 {
        Ok(content) => serde_json::from_str(&content).unwrap(),
        Err(e) => {
            log::info!("{:?}", e);
            Vec::new()
        }
    };

    let data3 = fs::read_to_string("src/npcs/npc_convos.json");
    //log::info!("{:?}", &data3);
    let convos: Vec<Convo> = match data3 {
        Ok(content) => serde_json::from_str(&content).unwrap(),
        Err(e) => {
            log::info!("{:?}", e);
            Vec::new()
        }
    };

    let mut ncount = 0;
    let mut icount = 0;
    //let mut cells = vec![vec![Cells::Null; 150]; 50];
    let mut npcs = HashMap::new();
    let mut items = HashMap::new();
    let mut env_inters = HashMap::new();
    for (y, line) in s_map.lines().skip(1).enumerate() {
        for (x, ch) in line.chars().enumerate() {
            let cell = match ch {
                '_' => Cells::Empty,
                '#' => Cells::Transparent,
                ',' => Cells::Grass1,
                'âš¶' => Cells::TallGrass,
                '\'' => Cells::Grass2,
                '\"' => Cells::Grass3,
                'Â·' => Cells::Dirt1,
                '.' => Cells::Dirt2,
                ':' => Cells::Dirt3,
                '*' => Cells::Rock,
                'â–’' => Cells::Wall,
                'â–“' => Cells::Wall2,
                'â–ˆ' => Cells::Wall3,
                'â–‘' => Cells::Wall4,
                'à¶‰' => Cells::Roots,
                'ðŸ¬¤' => Cells::Broken1,
                'ðŸ¬—' => Cells::Broken2,
                'ðŸ¬' => Cells::Broken3,
                'ðŸ¬‘' => Cells::Broken4,
                'ðŸ¬®' => Cells::Broken5,
                'ðŸ¬¡' => Cells::Broken6,
                ' ' => Cells::Floor,
                'â–§' => Cells::Tile1,
                'â–¨' => Cells::Tile2,
                'â–©' => Cells::Tile3,
                '~' => Cells::Water,
                'â•' => Cells::MwH,
                'â•‘' => Cells::MwV,
                'â•£' => Cells::MwVL,
                'â• ' => Cells::MwVR,
                'â•©' => Cells::MwHU,
                'â•¦' => Cells::MwHD,
                'â•' => Cells::MwUL,
                'â•š' => Cells::MwUR,
                'â•—' => Cells::MwDL,
                'â•”' => Cells::MwDR,
                'â•¬' => Cells::MwCR,
                'â”€' => Cells::SwH,
                'â”‚' => Cells::SwV,
                'â”¤' => Cells::SwVL,
                'â”œ' => Cells::SwVR,
                'â”´' => Cells::SwHU,
                'â”¬' => Cells::SwHD,
                'â”˜' => Cells::SwUL,
                'â””' => Cells::SwUR,
                'â”' => Cells::SwDL,
                'â”Œ' => Cells::SwDR,
                'â”¼' => Cells::SwCR,
                'â•Ÿ' => Cells::BsVR,
                'â•¢' => Cells::BsVL,
                'â•¤' => Cells::BsHD,
                'â•§' => Cells::BsHU,
                'â•­' => Cells::CurUL,
                'â•®' => Cells::CurUR,
                'â•°' => Cells::CurBL,
                'â•¯' => Cells::CurBR,
                'â”†' => Cells::BknWV,
                'â”„' => Cells::BknWH,
                'â‰¡' => Cells::Cong,
                'Â°' => Cells::Deg,
                'Ã—' => Cells::Mult,
                'Â¸' => Cells::Ced,
                'Â¨' => Cells::Diae,
                'â– ' => Cells::Blsq,
                'Â¦' => Cells::VBrk,
                'Â±' => Cells::PlMin,
                'Ã¸' => Cells::SmZer,
                'Ã˜' => Cells::BZer,
                'Â©' => Cells::Cop,
                'Ä¦' => Cells::DblBracedGate, //-------
                'á»»' => Cells::BracedGate,
                'Î ' => Cells::Arch,
                'Ê­' => Cells::Bricks,
                'Ê¬' => Cells::Crops,
                'Ñ§' => Cells::SmallCampfire,
                'Ñ¦' => Cells::Campfire,
                'Ï€' => Cells::Table,
                'á¹‘' => Cells::Jar,
                'â‘' => Cells::Chair,
                'Òº' => Cells::ChairRight1,
                'á‚¹' => Cells::ChairRight2,
                'Ð¶' => Cells::Firewood,
                'à¦Œ' => Cells::FireSmoke,
                'Ü€' => Cells::FireDiamond,
                'à®ƒ' => Cells::FireTri,
                'Å¦' => Cells::Stand1,
                'Å¸' => Cells::Stand2,
                'Å¤' => Cells::Stand3,
                'Æƒ' => Cells::StandBL,
                'ÆŒ' => Cells::StandDL,
                'Æ‚' => Cells::StandBS,
                'Æ‹' => Cells::StandDS,
                'â—' => Cells::CircleVL,
                'â£' => Cells::CircleHex,
                'âŒ¬' => Cells::CircleC,
                'âŒ¹' => Cells::Drawers,
                'âŒ¸' => Cells::Shelves,
                'âš±' => Cells::Vase,
                'ðœ²„' => Cells::LadderV,
                'ðœ²…' => Cells::LadderH,
                'ðœ²' => Cells::TickV,
                'ðœ²‘' => Cells::TickH,
                'á‰‹' => Cells::Tech1,
                'ðŸ»' => Cells::Tech2,
                'ðŸœŸ' => Cells::Tech3,
                'à¬' => Cells::Tech4,
                'Ò¦' => Cells::Tech5,
                'Ò¸' => Cells::Tech6,
                'Ò´' => Cells::Tech7,
                'à±' => Cells::Tech8,
                'ðœ°”' => Cells::Tech9,
                'ðœ°“' => Cells::Tech10,
                'ðœ°‰' => Cells::Tech11,
                'ðœ°Š' => Cells::Tech12,
                'â›€' => Cells::Tech13,
                'â›' => Cells::Tech14,
                'â›‚' => Cells::Tech15,
                'â›ƒ' => Cells::Tech16,
                'á‚©' => Cells::Tech17,
                'á‰–' => Cells::Relic1,
                'âš—' => Cells::Alembic,
                'á‰·' => Cells::OldWall1,
                'á‰¿' => Cells::OldWall2,
                'á‰¨' => Cells::OldWall3,
                'á‰©' => Cells::OldWall4,
                'á‰­' => Cells::OldWall5,
                'ðŸ€«' => Cells::CardTile1,
                'ðŸ€˜' => Cells::CardTile2,
                'ðŸ€†' => Cells::CardTile3,
                'ðŸ€™' => Cells::CardTile4,
                // '' => Cells::,
                'É…' => Cells::Tent,
                'ðŸ¢' => Cells::Bed,
                '&' => Cells::Bush,
                'á˜‰' => Cells::Bramble1,
                'á˜ˆ' => Cells::Bramble2,
                'á˜' => Cells::Bramble3,
                'á˜Š' => Cells::Bramble4,
                // '@' => Cells::NPCM,
                '{' => Cells::LBrce,
                '}' => Cells::RBrce,
                '(' => Cells::LParen,
                ')' => Cells::RParen,
                'Â¤' => Cells::GenCur,
                'o' => Cells::Item,
                'l' => Cells::Log,
                'c' => Cells::Clinic,
                'p' => Cells::GPost,
                's' => Cells::CPost,
                _ => Cells::Empty,
            };
            cells[y][x] = cell;
            if ch == '@' {
                let def_name = "Kevthony".to_string();
                match npc_types[ncount] {
                    "CommNPC" => {
                        //let com_def = vec!["Welcome to the caves!!".to_string(), "Theres a tonne of folk down here, lerger cities as you go into the cave.".to_string()];
                        let rnd_comms = {
                            let mut tvec = Vec::new();
                            for _ in 0..4 {
                                let tidx = rng.gen_range(0..comms.len());
                                tvec.push(comms[tidx].clone());
                            }
                            tvec
                        };
                        let name = names.choose(&mut rng).unwrap_or(&def_name.clone()).clone();
                        let t_comm = new_comm_npc(name.clone(), x, y, rnd_comms.clone());
                        npcs.insert((x, y), NPCWrap::CommNPC(t_comm.clone()));
                    }
                    "ConvNPC" => {
                        let name = names.choose(&mut rng).unwrap_or(&def_name.clone()).clone();
                        //let comms = vec!["Welcome to the caves!!".to_string(), "Theres a tonne of folk down here, lerger cities as you go into the cave.".to_string()];
                        let conv: Convo = convos
                            .choose(&mut rng)
                            .unwrap_or(&convos[0].clone())
                            .clone();
                        let t_comm = new_conv_npc(name.clone(), x, y, conv.clone());
                        npcs.insert((x, y), NPCWrap::ConvNPC(t_comm.clone()));
                    }
                    _ => todo!(),
                }
                ncount += 1;
            }
            if ch == 'O' {
                match item_types[icount] {
                    "HealthPotion" => {
                        let ti = Item::new_health_potion(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "Salve" => {
                        let ti = Item::new_salve(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "Dowel" => {
                        let ti = Item::new_dowel(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "SmallWoodShield" => {
                        let ti = Item::new_small_wood_shield(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "Apple" => {
                        let ti = Item::new_apple(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "BronzeClaymore" => {
                        let ti = Item::new_bronze_claymore(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "BronzeShortsword" => {
                        let ti = Item::new_bronze_shortsword(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "BronzeLongsword" => {
                        let ti = Item::new_bronze_longsword(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "BronzeLightAxe" => {
                        let ti = Item::new_bronze_light_axe(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "BronzeHeavyAxe" => {
                        let ti = Item::new_bronze_heavy_axe(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "BronzeWarAxe" => {
                        let ti = Item::new_bronze_war_axe(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "BronzePickHammer" => {
                        let ti = Item::new_bronze_pick_hammer(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "WoodStaff" => {
                        let ti = Item::new_wood_staff(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    "LightArmour" => {
                        let ti = Item::new_light_armour(x, y);
                        items.insert((x, y), ti.clone());
                    }
                    _ => {
                        log::info!("itm {:?}", item_types[icount]);
                    }
                }
                icount += 1;
            }
            if ch == 'l' {
                env_inters.insert((x, y), EnvInter::Records);
            }
            if ch == 'p' {
                env_inters.insert((x, y), EnvInter::GuildPost);
            }
            if ch == 'c' {
                env_inters.insert((x, y), EnvInter::Clinic);
            }
            if ch == 'C' {
                env_inters.insert((x, y), EnvInter::Construction);
            }
            if ch == 's' {
                env_inters.insert((x, y), EnvInter::ChurchPost);
            }
            if ch == 'â„§' {
                env_inters.insert((x, y), EnvInter::Cauldron);
            }
            if ch == 'h' {
                env_inters.insert((x, y), EnvInter::Herbalist);
            }
            if ch == 'd' {
                env_inters.insert(
                    (x, y),
                    EnvInter::Door(Door::HLocked(rng.gen_range(0..10) as u8)),
                );
            }
            if ch == 'D' {
                env_inters.insert(
                    (x, y),
                    EnvInter::Door(Door::VLocked(rng.gen_range(0..10) as u8)),
                );
            }
        }
    }
    (cells, npcs, items, env_inters)
}

fn make_small_ruin_feature() -> (
    Vec<Vec<Cells>>,
    HashMap<(usize, usize), NPCWrap>,
    HashMap<(usize, usize), Item>,
    HashMap<(usize, usize), EnvInter>,
) {
    let cells = vec![vec![Cells::Empty; 80]; 20];
    let mut rng = rand::thread_rng();
    parse_map(SMALL_RUINS.choose(&mut rng).unwrap_or(&SMALL_RUIN_1), cells)
}

fn make_abandoned_shack() -> (
    Vec<Vec<Cells>>,
    HashMap<(usize, usize), NPCWrap>,
    HashMap<(usize, usize), Item>,
    HashMap<(usize, usize), EnvInter>,
) {
    let cells = vec![vec![Cells::Empty; 40]; 12];
    let mut rng = rand::thread_rng();
    parse_map(
        ABANDONED_SHACKS
            .choose(&mut rng)
            .unwrap_or(&ABANDONED_SHACK_1),
        cells,
    )
}

fn make_construction_feature() -> (
    Vec<Vec<Cells>>,
    HashMap<(usize, usize), NPCWrap>,
    HashMap<(usize, usize), Item>,
    HashMap<(usize, usize), EnvInter>,
) {
    let cells = vec![vec![Cells::Empty; 40]; 12];
    let mut rng = rand::thread_rng();
    parse_map(
        CONSTRUCTION.choose(&mut rng).unwrap_or(&CONSTRUCTION_1),
        cells,
    )
}

fn make_pond_feature() -> (
    Vec<Vec<Cells>>,
    HashMap<(usize, usize), NPCWrap>,
    HashMap<(usize, usize), Item>,
    HashMap<(usize, usize), EnvInter>,
) {
    let cells = vec![vec![Cells::Empty; 75]; 25];
    let mut rng = rand::thread_rng();
    parse_map(POND.choose(&mut rng).unwrap_or(&POND_1), cells)
}

#[derive(Clone, PartialEq, Eq, Copy, PartialOrd, Ord)]
enum Field {
    Normal,
    NormalTrans,
    InCornerUL,
    InCornerUR,
    InCornerDL,
    InCornerDR,
    OutCornerUL,
    OutCornerUR,
    OutCornerDL,
    OutCornerDR,
    HorzEdgeU,
    HorzEdgeD,
    VertEdgeL,
    VertEdgeR,
    Shrub,
    Empty,
    EmptyTrans,
    Null,
}

const UP_FULL: [Field; 6] = [
    Field::Normal,
    Field::InCornerDL,
    Field::InCornerDR,
    Field::HorzEdgeU,
    Field::Shrub,
    Field::NormalTrans,
];

const UP_LEFT: [Field; 3] = [Field::VertEdgeR, Field::InCornerUL, Field::OutCornerUR];

const UP_RIGHT: [Field; 3] = [Field::VertEdgeL, Field::InCornerUR, Field::OutCornerUL];

const UP_EMPTY: [Field; 5] = [
    Field::Empty,
    Field::EmptyTrans,
    Field::HorzEdgeD,
    Field::OutCornerDL,
    Field::OutCornerDR,
];

const LEFT_FULL: [Field; 6] = [
    Field::Normal,
    Field::NormalTrans,
    Field::InCornerUR,
    Field::InCornerDR,
    Field::VertEdgeL,
    Field::Shrub,
];

const LEFT_TOP: [Field; 3] = [Field::InCornerUL, Field::OutCornerDL, Field::HorzEdgeD];

const LEFT_BOTT: [Field; 3] = [Field::InCornerDL, Field::OutCornerUL, Field::HorzEdgeU];

const LEFT_EMPTY: [Field; 5] = [
    Field::Empty,
    Field::EmptyTrans,
    Field::VertEdgeR,
    Field::OutCornerDR,
    Field::OutCornerUR,
];

pub fn tile_to_chars(tile: &str) -> Vec<Vec<char>> {
    tile.trim()
        .lines()
        .map(|line| line.chars().collect())
        .collect()
}

fn build_field() -> String {
    let mut rng = rand::thread_rng();
    let mut cells = vec![vec![' '; 128]; 64];
    let mut temp = vec![vec![Field::Empty; 8]; 8];
    // temp[0][0] = Field::OutCornerUL;
    for j in (0..temp.len()) {
        for i in (0..temp[0].len()) {
            let up = if j > 0 { temp[j - 1][i] } else { Field::Null };
            let left = if i > 0 { temp[j][i - 1] } else { Field::Null };
            temp[j][i] = {
                match (up, left) {
                    (Field::Null, Field::Null) => Field::OutCornerUL,
                    (up, left) if j == temp.len() - 1 && i == temp[0].len() - 1 => {
                        if UP_EMPTY.contains(&up) {
                            Field::Empty
                        } else {
                            Field::OutCornerDR
                        }
                    }
                    (Field::Null, left) => {
                        if i == temp[0].len() - 1 && LEFT_BOTT.contains(&left) {
                            Field::OutCornerUR
                        } else if i == temp[0].len() - 1 && LEFT_EMPTY.contains(&left) {
                            Field::Empty
                        } else if LEFT_BOTT.contains(&left) {
                            *[
                                Field::HorzEdgeU,
                                Field::HorzEdgeU,
                                Field::HorzEdgeU,
                                Field::OutCornerUR,
                            ]
                            .choose(&mut rng)
                            .unwrap_or(&Field::HorzEdgeU)
                        } else if LEFT_EMPTY.contains(&left) {
                            Field::OutCornerUL
                        } else {
                            Field::Empty
                        }
                    }
                    (up, Field::Null) => {
                        if j == temp.len() - 1 && UP_RIGHT.contains(&up) {
                            Field::OutCornerDL
                        } else if j == temp.len() - 1 && UP_EMPTY.contains(&up) {
                            Field::Empty
                        } else if UP_RIGHT.contains(&up) {
                            *[
                                Field::VertEdgeL,
                                Field::VertEdgeL,
                                Field::VertEdgeL,
                                Field::OutCornerDL,
                            ]
                            .choose(&mut rng)
                            .unwrap_or(&Field::VertEdgeL)
                        } else {
                            Field::OutCornerUL
                        }
                    }
                    (up, left) if i == temp[0].len() - 1 => {
                        if UP_LEFT.contains(&up) && LEFT_FULL.contains(&left) {
                            Field::VertEdgeR
                        } else if UP_LEFT.contains(&up) && LEFT_TOP.contains(&left) {
                            Field::OutCornerDR
                        } else if UP_EMPTY.contains(&up) && LEFT_BOTT.contains(&left) {
                            Field::OutCornerUR
                        } else {
                            Field::Empty
                        }
                    }
                    (up, left) if j == temp.len() - 1 => {
                        if UP_FULL.contains(&up) && LEFT_TOP.contains(&left) {
                            Field::HorzEdgeD
                        } else if UP_LEFT.contains(&up) && LEFT_TOP.contains(&left) {
                            Field::OutCornerDR
                        } else if UP_RIGHT.contains(&up) && LEFT_EMPTY.contains(&left) {
                            Field::OutCornerDL
                        } else {
                            Field::Empty
                        }
                    }
                    (up, left) if UP_FULL.contains(&up) && LEFT_FULL.contains(&left) => *[
                        Field::Normal,
                        Field::Normal,
                        Field::Normal,
                        Field::NormalTrans,
                        Field::InCornerUL,
                        Field::Shrub,
                    ]
                    .choose(&mut rng)
                    .unwrap_or(&Field::Normal),
                    (up, left) if UP_FULL.contains(&up) && LEFT_TOP.contains(&left) => {
                        *[Field::HorzEdgeD, Field::InCornerUR]
                            .choose(&mut rng)
                            .unwrap_or(&Field::HorzEdgeD)
                    }
                    (up, left) if UP_EMPTY.contains(&up) && LEFT_BOTT.contains(&left) => {
                        *[Field::HorzEdgeU, Field::OutCornerUR]
                            .choose(&mut rng)
                            .unwrap_or(&Field::HorzEdgeU)
                    }
                    (up, left) if UP_EMPTY.contains(&up) && LEFT_EMPTY.contains(&left) => {
                        // *[Field::OutCornerUR]
                        //     .choose(&mut rng)
                        //     .unwrap_or(&Field::HorzEdgeU
                        Field::OutCornerUL
                    }
                    (up, left) if UP_LEFT.contains(&up) && LEFT_FULL.contains(&left) => {
                        *[Field::VertEdgeR, Field::InCornerDL]
                            .choose(&mut rng)
                            .unwrap_or(&Field::VertEdgeR)
                    }
                    (up, left) if UP_LEFT.contains(&up) && LEFT_TOP.contains(&left) => {
                        Field::OutCornerDR
                    }
                    (up, left) if UP_RIGHT.contains(&up) && LEFT_EMPTY.contains(&left) => {
                        *[Field::VertEdgeL, Field::OutCornerDL]
                            .choose(&mut rng)
                            .unwrap_or(&Field::VertEdgeL)
                    }
                    (up, left) if UP_RIGHT.contains(&up) && LEFT_BOTT.contains(&left) => {
                        Field::InCornerDR
                    }
                    _ => Field::EmptyTrans,
                }
                // Field::Null
            }
        }
    }
    for j in 0..temp.len() {
        for i in 0..temp[0].len() {
            let patch = match temp[j][i] {
                Field::Normal => GRASS_PATCH,
                Field::NormalTrans => GRASS_PATCH,
                Field::OutCornerUL => GRASS_OUT_CORNER_UL,
                Field::OutCornerUR => GRASS_OUT_CORNER_UR,
                Field::OutCornerDL => GRASS_OUT_CORNER_BL,
                Field::OutCornerDR => GRASS_OUT_CORNER_BR,
                Field::InCornerUL => GRASS_IN_CORNER_UL,
                Field::InCornerUR => GRASS_IN_CORNER_UR,
                Field::InCornerDL => GRASS_IN_CORNER_BL,
                Field::InCornerDR => GRASS_IN_CORNER_BR,
                Field::HorzEdgeU => GRASS_HORZ_U,
                Field::HorzEdgeD => GRASS_HORZ_B,
                Field::VertEdgeL => GRASS_VERT_L,
                Field::VertEdgeR => GRASS_VERT_R,
                Field::Empty => GRASS_EMPTY,
                Field::Shrub => SHRUB_PATCH,
                Field::EmptyTrans => GRASS_EMPTY_TRANS,
                _ => todo!(),
            };
            let patch_chars = tile_to_chars(patch);
            for y in 0..8 {
                for x in 0..16 {
                    cells[j * 8 + y][i * 16 + x] = patch_chars[y][x];
                }
            }
        }
    }
    std::iter::once("Null|Null|Null".to_string())
        .chain(cells.iter().map(|row| row.iter().collect::<String>()))
        .collect::<Vec<String>>()
        .join("\n")
}

fn make_field() -> (
    Vec<Vec<Cells>>,
    HashMap<(usize, usize), NPCWrap>,
    HashMap<(usize, usize), Item>,
    HashMap<(usize, usize), EnvInter>,
) {
    let cells = vec![vec![Cells::Empty; 128]; 64];
    parse_map(&build_field(), cells)
}

fn make_stream() -> (
    Vec<Vec<Cells>>,
    HashMap<(usize, usize), NPCWrap>,
    HashMap<(usize, usize), Item>,
    HashMap<(usize, usize), EnvInter>,
) {
    let cells = vec![vec![Cells::Empty; 128]; 64];
    parse_map(&build_stream(), cells)
}

#[derive(Clone, Debug, PartialEq)]
pub struct Feature {
    pub ftype: FeatureType,
    pub pos: (i16, i16),
    pub map: Vec<Vec<Cells>>,
    pub items: HashMap<(usize, usize), Item>,
    pub npcs: HashMap<(usize, usize), NPCWrap>,
    pub env_inters: HashMap<(usize, usize), EnvInter>,
    pub cont_sent: bool,
    pub hermit: bool,
    pub hermit_pos: (usize, usize),
    pub hermit_map: Vec<Vec<Cells>>,
}

impl Feature {
    pub fn place_hermit(&mut self) {
        for j in (0..self.map.len() - 6) {
            for i in (0..self.map[0].len() - 10) {
                let check = {
                    let mut ch = true;
                    for jj in j..(j + 6) {
                        if !ch {
                            break;
                        }
                        for ii in i..(i + 10) {
                            if self.map[jj][ii] != Cells::Empty {
                                ch = false;
                                break;
                            }
                        }
                    }
                    ch
                };
                if check {
                    self.hermit_pos = (i, j);
                    break;
                }
            }
        }
    }

    pub fn place_hermit_parts(&mut self) {
        let mut map = self.map.clone();
        let hermit = HERMIT_1;
        let mut items = HashMap::new();
        let mut env_inters = HashMap::new();
        let mut scroll = false;
        for (j, line) in hermit.lines().enumerate() {
            for (i, ch) in line.chars().enumerate() {
                match ch {
                    'x' => {
                        env_inters.insert(
                            (self.hermit_pos.0 + i, self.hermit_pos.1 + j),
                            EnvInter::Hermit,
                        );
                    }
                    'o' if !scroll => {
                        items.insert(
                            (self.hermit_pos.0 + i, self.hermit_pos.1 + j),
                            Item::new_scroll(self.hermit_pos.0 + i, self.hermit_pos.1 + j),
                        );
                        scroll = true;
                    }
                    'o' => {
                        items.insert(
                            (self.hermit_pos.0 + i, self.hermit_pos.1 + j),
                            rand_hermit_item(self.hermit_pos.0 + i, self.hermit_pos.1 + j),
                        );
                    }
                    _ => {}
                }
                map[self.hermit_pos.1 + j][self.hermit_pos.0 + i] = ch_to_enum(ch);
            }
        }
        self.items = items;
        self.env_inters = env_inters;
        self.hermit_map = map;
    }
}

pub struct Features {
    features: HashMap<(i16, i16), Feature>,
}

impl Features {
    pub fn new() -> Self {
        Self {
            features: HashMap::new(),
        }
    }

    pub fn get_feature_positions(&self) -> Vec<String> {
        let mut feat_vec = Vec::new();
        for (pos, f) in self.features.clone() {
            feat_vec.push(format!("({}, {}): {:?}", pos.0, pos.1, f.ftype));
        }
        feat_vec
    }

    pub fn new_rand_feature(&mut self, pos: (i16, i16)) {
        let mut rng = rand::thread_rng();
        // let choice = *[
        //     FeatureType::AbandonedShack,
        //     FeatureType::Field,
        //     FeatureType::Ruin,
        //     FeatureType::Stream,
        //     FeatureType::Construction,
        //     FeatureType::Pond,
        // ]
        // .choose(&mut rng)
        // .unwrap_or(&FeatureType::AbandonedShack);
        let choice = FeatureType::Pond;
        match choice {
            FeatureType::AbandonedShack => self.new_abandoned_shack(pos),
            FeatureType::Field => self.new_field_feature(pos),
            FeatureType::Ruin => self.new_small_ruin_feature(pos),
            FeatureType::Stream => self.new_stream_feature(pos),
            FeatureType::Construction => self.new_construction_feature(pos),
            FeatureType::Pond => self.new_pond_feature(pos),
            _ => self.new_abandoned_shack(pos),
        }
    }

    pub fn new_small_ruin_feature(&mut self, pos: (i16, i16)) {
        let (map, npcs, items, env_inters) = make_small_ruin_feature();
        self.features.insert(
            pos,
            Feature {
                ftype: FeatureType::Ruin,
                pos,
                map,
                items,
                npcs,
                env_inters,
                cont_sent: false,
                hermit: false,
                hermit_pos: (0, 0),
                hermit_map: Vec::new(),
            },
        );
    }

    pub fn new_construction_feature(&mut self, pos: (i16, i16)) {
        let (map, npcs, items, env_inters) = make_construction_feature();
        self.features.insert(
            pos,
            Feature {
                ftype: FeatureType::Construction,
                pos,
                map,
                items,
                npcs,
                env_inters,
                cont_sent: false,
                hermit: false,
                hermit_pos: (0, 0),
                hermit_map: Vec::new(),
            },
        );
    }

    pub fn new_pond_feature(&mut self, pos: (i16, i16)) {
        let (map, npcs, items, env_inters) = make_pond_feature();
        self.features.insert(
            pos,
            Feature {
                ftype: FeatureType::Pond,
                pos,
                map,
                items,
                npcs,
                env_inters,
                cont_sent: false,
                hermit: false,
                hermit_pos: (0, 0),
                hermit_map: Vec::new(),
            },
        );
    }

    pub fn new_field_feature(&mut self, pos: (i16, i16)) {
        let (map, npcs, items, env_inters) = make_field();
        self.features.insert(
            pos,
            Feature {
                ftype: FeatureType::Field,
                pos,
                map,
                items,
                npcs,
                env_inters,
                cont_sent: false,
                hermit: false,
                hermit_pos: (0, 0),
                hermit_map: Vec::new(),
            },
        );
    }

    pub fn new_stream_feature(&mut self, pos: (i16, i16)) {
        let (map, npcs, items, env_inters) = make_stream();
        self.features.insert(
            pos,
            Feature {
                ftype: FeatureType::Stream,
                pos,
                map,
                items,
                npcs,
                env_inters,
                cont_sent: false,
                hermit: false,
                hermit_pos: (0, 0),
                hermit_map: Vec::new(),
            },
        );
    }

    pub fn new_abandoned_shack(&mut self, pos: (i16, i16)) {
        let (map, npcs, items, env_inters) = make_abandoned_shack();
        self.features.insert(
            pos,
            Feature {
                ftype: FeatureType::AbandonedShack,
                pos,
                map,
                items,
                npcs,
                env_inters,
                cont_sent: false,
                hermit: false,
                hermit_pos: (0, 0),
                hermit_map: Vec::new(),
            },
        );
    }

    pub fn check_location(&self, bpos: (i16, i16), rad: u16) -> Option<Feature> {
        for (spos, s) in &self.features {
            let xx = (spos.0 - bpos.0 * -1) as i32;
            let yy = (spos.1 - bpos.1 * -1) as i32;
            let hyp = ((xx.pow(2) + yy.pow(2)) as f64).sqrt() as u64;
            if hyp <= rad.into() {
                return Some(s.clone());
            }
        }
        return None;
    }

    pub fn update_feature(&mut self, feature: Feature) {
        self.features.insert(feature.pos, feature);
    }

    pub fn feature_check(&mut self, pos: (i16, i16)) -> bool {
        let dir = (pos.0 / pos.0.abs(), pos.1 / pos.1.abs());
        let space = {
            match dir {
                (x, y) if x >= 0 && y >= 0 => (((pos.0 + 800), (pos.1 + 800)), pos),
                (x, y) if x < 0 && y >= 0 => (((pos.0 - 800), (pos.1 + 800)), pos),
                (x, y) if x >= 0 && y < 0 => (((pos.0 + 800), (pos.1 - 800)), pos),
                (x, y) if x < 0 && y < 0 => (((pos.0 - 800), (pos.1 - 800)), pos),
                _ => todo!(),
            }
        };
        for (k, _) in self.features.clone() {
            let xrange: Vec<i16> = {
                let mut xa = space.0 .0;
                let mut xb = space.1 .0;
                if xa > xb {
                    std::mem::swap(&mut xa, &mut xb);
                }
                (xa..xb).collect()
            };
            let yrange: Vec<i16> = {
                let mut ya = space.0 .0;
                let mut yb = space.1 .0;
                if ya > yb {
                    std::mem::swap(&mut ya, &mut yb);
                }
                (ya..yb).collect()
            };

            if xrange.contains(&k.0) && yrange.contains(&k.1) {
                return false;
            };
        }
        true
    }
}
