use crate::enums::{Cells, Door, EnvInter, FeatureType, NPCWrap};
use crate::item::{rand_hermit_item, Item};
use crate::npc::{new_comm_npc, new_conv_npc, new_shop_npc, Convo, ShopConvos, ShopData};
use crate::parsing::{parse_map, tile_to_chars};

use rand::prelude::SliceRandom;
use rand::Rng;
use std::collections::HashMap;

const CONSTRUCTION_BLANK: &str = r#"Null|Null|Null
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
________________________________________
"#;

const CONSTRUCTION_1: &str = r#"CommNPC CommNPC CommNPC CommNPC CommNPC|Null|Null
######â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“  . ,  C Â·  â–“â–“â–“â–“####
######â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â”¬â”¬â”¬â”¬â”¬â”â”Œâ”¬â”¬â”¬â”¬â”¬â–“â–“â–“â–“â–“â–“##
â–‘â–‘â–‘â–‘â–‘â–‘â–‘ðŸ¬—â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“ðŸ¬ðŸ¬‘        '  â”‚â–“â–“â–“â–“â–“â–“##
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“ðŸ¬®ðŸ¬¡@      *   â”‚â–“â–“â–“â–“â–“â–“##
,   â–‘â–‘â–‘â–‘     Â·, â”‚ @ Â·Â·'   Â·    â”œâ”¬â”¬â”¬â”â–“â–“##
    â–‘â–‘â–‘â–‘     ,  â”‚   ,   Â·   â‘  â”Œâ”€â” â”‚â–“â–“##
.  Â·â–‘â–‘â–‘â–‘ *.     â”œâ”¬â”¬â”    @ Ñ§  â‘ â”œâ•¦â”¤ â”œâ–“â–“##
    â–‘â–‘â–‘â–‘   '   , , â”œâ”¬â”¬â”   ' ,,   @  â–“â–“##
,   â–‘â–‘â–‘â–‘   . ,      * â”œâ”â”Œâ”     @ðŸ¬®ðŸ¬¡ðŸ¬‘â–“â–“ðŸ¬—â–“â–“
    â–‘â–‘â–‘â–‘   .          C  â”œâ”¬â”¬â” Â· â–“â–“â–“â–“ðŸ¬—â–“â–“â–“
    â–‘â–‘â–‘â–‘                '   â”œâ”¬â”¬â”¬â–“â–“â–“â–“â–“ðŸ¬—â–“â–“
    ðŸ¬â–‘â–‘â–‘               , Â·      â–“â–“â–“â–“â–“â–“â–“â–“
"#;

const CONSTRUCTION_2: &str = r#"CommNPC CommNPC CommNPC CommNPC CommNPC CommNPC|Null|Null
' ######### ðŸ¬žâ–“â–“â–“     C   '  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ðŸ­
##        , â–“â–“â–“â–“â”Œâ”¬â”¬â”¬â”¬â”â”Œâ”¬â”¬â”¬â”¬â”â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
## *        â–“â–“â–“â–“         .  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
##.         â–“â–“ðŸ¬‘ðŸ¬—   @  â‘    @ðŸ¬‘â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
##       , 'â–“â–“â–“ðŸ¬¡     Ñ§ â‘    ðŸ¬¡ðŸ¬®â–“â–“   Â·    
##          â–“â–“â–“ðŸ¬—@   â–“â–“â–“ðŸ­   @ðŸ¬¦â–“â–“â–“    '   
##          â–“â–“â–“â–“Ï€@  â–“â–“â–“â–“Â·Â·  â–“â–“â–“â–“   .  , 
## *    '   â–“â–“â–“â–“,   â–“â–“â–“â–“   Â·ðŸ¬¡ðŸ¬—â–“â–“        
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“Â·  @ðŸ¬‘â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ðŸ¬¿
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“   *â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â”Œâ”¬â”¬â”â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
â–“â–“â–“â–“â–“â–“â–“à¶‰â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ðŸ­  C  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
"#;

const CONSTRUCTION_3: &str = r#"CommNPC CommNPC CommNPC CommNPC CommNPC|Null|Null
## '   ,,    '   ,,#########â–“â–“â–“â–“   *â–“â–“â–“â–“
## . ,    * *           â–“â–“â–“â–“â–“ðŸ¬—â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
## .                *  Â·â–“â–“â–“â–“ðŸ¬—â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
##          '        â”Œâ”¬â”â–“â–“â–“â–“â–“ðŸ¬—â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
##              ,CÂ·â”Œâ”¬â”¤  â–“â–“ðŸ¬¡ðŸ¬‘ðŸ¬‘â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“à¶‰
.'     ,   ,  â”Œâ”¬â”â”Œâ”¬â”¤   É… .@ ðŸ¬®â–“â–“â–“    â–“â–“â–“â–“
            â”Œâ”¬â”¤             â–“â–“â–“â–“    â–“â–“â–“â–“
   *      â”Œâ”¬â”¤        Ñ§ â‘ '' ðŸ¬‘â–“â–“â–“  . â–“â–“â–“â–“
     Â· ,  â”‚  *  @  @     @ @ðŸ¬—â–“â–“â–“.   â–“â–“â–“â–“
â–’â–’â–’â–’â–’â–’â–’â–’â–“â–“â–“â–“â–“â–“â–“ðŸ¬‘ðŸ¬¡ðŸ¬‘ðŸ¬—ðŸ¬‘ðŸ¬®â–“â–“â–“ðŸ¬‘ðŸ¬®ðŸ¬¡ðŸ¬®ðŸ¬‘â–“â–“â–“ *  â–“â–“â–“â–“
â–’â–’â–’â–’â–’â–’â–’â–’â–“â–“â–“â–“â–“â–“â–“â–“ðŸ¬‘ðŸ¬®ðŸ¬¡â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“    â–“â–“â–“â–“
â–’â–’â–’â–’â–’â–’â–’â–’â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“    â–“â–“â–“â–“
"#;

const CONSTRUCTION: [&str; 3] = [CONSTRUCTION_1, CONSTRUCTION_2, CONSTRUCTION_3];

pub fn make_construction_feature() -> (
    Vec<Vec<Cells>>,
    HashMap<(usize, usize), NPCWrap>,
    HashMap<(usize, usize), Item>,
    HashMap<(usize, usize), EnvInter>,
) {
    let cells = vec![vec![Cells::Empty; 40]; 12];
    let mut rng = rand::thread_rng();
    parse_map(
        CONSTRUCTION.choose(&mut rng).unwrap_or(&CONSTRUCTION_1),
        cells,
    )
}
